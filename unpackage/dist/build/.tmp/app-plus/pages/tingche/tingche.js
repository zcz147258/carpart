(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/tingche/tingche"],{"079d":function(t,e,a){},6855:function(t,e,a){"use strict";var i=a("079d"),s=a.n(i);s.a},"6d11":function(t,e,a){"use strict";(function(t){a("949b"),a("921b");i(a("66fd"));var e=i(a("9fbf"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("6e42")["createPage"])},"79b9":function(t,e,a){"use strict";var i,s=function(){var t=this,e=t.$createElement;t._self._c},n=[];a.d(e,"b",function(){return s}),a.d(e,"c",function(){return n}),a.d(e,"a",function(){return i})},"9fbf":function(t,e,a){"use strict";a.r(e);var i=a("79b9"),s=a("ea36");for(var n in s)"default"!==n&&function(t){a.d(e,t,function(){return s[t]})}(n);a("6855");var o,r=a("f0c5"),l=Object(r["a"])(s["default"],i["b"],i["c"],!1,null,"7a16f036",null,!1,i["a"],o);e["default"]=l.exports},d509:function(t,e,a){"use strict";(function(t,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=1,n="目前应付%dPayable%元，可停至%sToTime1%，欠费%dNowDebt%元",o="购买%dBuyHours%小时，需支付%dBuyMoney%元，可停至%sToTime2%",r="继续购买%dBuyHours%小时，需支付%dBuyMoney%元，可停至%sToTime2%",l=function(){return Promise.all([a.e("common/vendor"),a.e("components/berth-number/berth-number")]).then(a.bind(null,"eb5f"))},h=function(){return Promise.all([a.e("common/vendor"),a.e("components/plate-number/inputPlateNumber/inputPlateNumber")]).then(a.bind(null,"9b24"))},u=function(){return a.e("components/plate-number/historyPlateNumber/historyPlateNumber").then(a.bind(null,"cbe0"))},p=function(){return a.e("components/parking-time/parking-time").then(a.bind(null,"56ea"))},c=function(){return a.e("components/parking-time/parking-time-list").then(a.bind(null,"ae64"))},d=function(){return a.e("components/uni-popup/uni-popup").then(a.bind(null,"569a"))},w={components:{berthNumber:l,inputPlateNumber:h,historyPlateNumber:u,parkingTime:p,parkingTimeList:c,uniPopup:d},data:function(){return{scp:{plateNo:"        ",plateNoList:[],plateNoActiveIndex:-1,activeShow:!0},scwh:{spaceNo:"     "},ignoreEnd:!0,stp:{parkingTime:0,parkingTimeList:[],parkingTimeActiveIndex:-1,disableCan:!0,enable:!0,payMoney:0},tips:{showTip0:"",showTip1:"",moneyTips0:"",moneyTips1:"",moneyTips2:""},wxData:{}}},onShow:function(){this.$checkLogin(),this.isSpaceNoFlag(this.spaceNo)&&this.runCpcwh(2,this.spaceNo)},onLoad:function(){this.stp.parkingTimeList=[.5,1,1.5,2,2.5,3,3.5,4],this.getinfo()},methods:{getinfo:function(){var t=this;this.$http.request({url:"/wx/jsonLotparking",success:function(e){if(e.data.success){t.debtinfo=e.data.result.jaPlateDebts;var a=[];e.data.result.jsPlates.forEach(function(t,e){a.push(t.sPlateNo)}),t.scp.plateNoList=a}else t.$api.msg(e.data.result.sErrInfo)}})},openShowTips:function(t,e){var a=this;switch(t){case 0:this.tips.showTip0=e,this.$nextTick(function(){a.$refs["showTip0"].open()});break;case 1:this.tips.showTip1=e,this.$nextTick(function(){a.$refs["showTip1"].open()});break;case 2:this.$nextTick(function(){a.$refs["showTip2"].open()});break}},spaceNoChange:function(t){this.scwh.spaceNo!=t&&(this.scwh.spaceNo=t,this.isSpaceNoFlag(t)&&this.runCpcwh(2,t))},isSpaceNoFlag:function(t){return t||(t=this.scwh.spaceNo),t.replace(/\s+/g,"").length>4},plateNoChange:function(t){if(this.scp.plateNo!=t){for(var e=-1,a=this.scp.plateNoList,i=0;i<a.length;i++)if(a[i]==t.replace(/\s+/g,"")){e=i;break}-1!=e?this.clikehistoryPlateNo(e):(this.scp.plateNoActiveIndex=e,this.scp.plateNo=t,this.isPlateNoFlag(t)&&this.runCpcwh(1,t))}},isActiveShowChange:function(t){this.scp.activeShow=t},clikehistoryPlateNo:function(t){var e=this.scp.plateNoList[t];8!=e.length?this.scp.activeShow=!0:this.scp.activeShow=!1,this.scp.plateNo=e,this.scp.plateNoActiveIndex=t,this.runCpcwh(1,e)},isPlateNoFlag:function(t){t||(t=this.scp.plateNo);for(var e=!0,a=0;a<7;a++)if(" "==t.slice(a,a+1)){e=!1;break}var i=t.replace(/\s+/g,"");return!!(e&&i.length>6)},parkingTimeChange:function(t){if(this.stp.parkingTime!=t){this.stp.parkingTime=t;for(var e=-1,a=this.stp.parkingTimeList,i=0;i<a.length;i++)if(a[i]==t){e=i;break}this.stp.parkingTimeActiveIndex=e,this.runCpcwh(3,t)}},clikeParkingTime:function(t){var e=this.stp.parkingTimeList[t];this.parkingTimeChange(e)},clikeTips:function(t){var e=this;switch(t){case 1:this.isSpaceNoFlag()?this.$http.request({url:"/wx/findChargingStandard",data:{spaceNo:this.scwh.spaceNo},dataType:"json",success:function(t){t.data.success&&e.openShowTips(1,t.data.chargingStandard)}}):this.openShowTips(0,"请输入泊位号后再查询收费规则！");break;case 2:this.openShowTips(2,null);break}},runCpcwh:function(e,a){var i=this;if(1==e){var s=a||this.scp.plateNo,n=null;this.isSpaceNoFlag()&&(n=this.scwh.spaceNo),this.$http.request({url:"/wx/jsonSelectCpcw",data:{plateNo:s,spaceNo:n,priority:0},dataType:"json",success:function(t){var a=t.data;a.success?i.applyData(e,a):i.openShowTips(0,a.errorText)},fail:function(e){console.log(t(e," at pages\\tingche\\tingche.vue:367"))}})}else if(2==e){var o=a||this.scwh.spaceNo,r=null;this.isPlateNoFlag()&&(r=this.scp.plateNo),this.$http.request({url:"/wx/jsonSelectCpcw",data:{plateNo:r,spaceNo:o,priority:1},dataType:"json",success:function(t){var a=t.data;a.success?i.applyData(e,a):i.openShowTips(0,a.errorText)},fail:function(e){console.log(t(e," at pages\\tingche\\tingche.vue:395"))}})}else 3==e&&null!=this.wxData.lRule1Id&&void 0!=this.wxData.lRule1Id&&"0"!=this.wxData.lRule1Id&&this.$http.request({url:"/wx/jsonBuyHours",data:{lRule1Id:this.wxData.lRule1Id,lTime1:this.wxData.lTime1,lTime2:this.wxData.lTime2,lPayTime:this.wxData.lPayTime,dBuyHours:a},dataType:"json",success:function(t){var a=t.data;a.success?i.applyData(e,a):i.openShowTips(0,a.errorText)},fail:function(e){console.log(t(e," at pages\\tingche\\tingche.vue:422"))}})},applyData:function(t,e){var a=e.result;if(this.wxData.iErrCode=a.iErrCode,this.wxData.sErrInfo=a.sErrInfo,this.wxData.sErrInfo&&this.openShowTips(0,this.wxData.sErrInfo),0==this.wxData.iErrCode){null!=a.iCustCanOrder&&void 0!=a.iCustCanOrder&&(this.wxData.iCustCanOrder=a.iCustCanOrder),null!=a.sPlateNo&&"{}"!=JSON.stringify(a.sPlateNo)&&(this.wxData.sPlateNo=a.sPlateNo,this.plateNoChange(a.sPlateNo)),null!=a.sSpaceNo&&"{}"!=JSON.stringify(a.sSpaceNo)&&(this.wxData.sSpaceNo=a.sSpaceNo,this.spaceNoChange(a.sSpaceNo));var i=!1;1==t||2==t?this.isSpaceNoFlag()?(null!=a.lRule1Id&&void 0!=a.lRule1Id&&"0"!=a.lRule1Id&&(this.wxData.lOrderId=a.lOrderId,this.wxData.iSpecial=a.iSpecial,this.wxData.lRule1Id=a.lRule1Id,this.wxData.dPayable=a.dPayable,this.wxData.dNowDebt=a.dNowDebt,this.wxData.dBuyHours=a.dBuyHours,this.wxData.dBuyMoney=a.dBuyMoney,this.wxData.lTime1=a.lTime1,this.wxData.lTime2=a.lTime2,this.wxData.lPayTime=a.lPayTime,this.wxData.lToTime1=a.lToTime1,this.wxData.sToTime1=a.sToTime1,this.wxData.lToTime2=a.lToTime2,this.wxData.sToTime2=a.sToTime2,this.wxData.hisDebt=a.hisDebt),0==this.wxData.iCustCanOrder&&(null!=this.wxData.lOrderId&&void 0!=this.wxData.lOrderId?i=0==this.wxData.lOrderId:this.isPlateNoFlag()&&(i=!0))):this.fireWhenNoCwh():3==t&&null!=a.lRule1Id&&void 0!=a.lRule1Id&&"0"!=a.lRule1Id&&(this.wxData.lRule1Id=a.lRule1Id,this.wxData.dBuyHours=a.dBuyHours,this.wxData.dBuyMoney=a.dBuyMoney,this.wxData.lTime1=a.lTime1,this.wxData.lTime2=a.lTime2,this.wxData.lPayTime=a.lPayTime,this.wxData.lToTime1=a.lToTime1,this.wxData.sToTime1=a.sToTime1,this.wxData.lToTime2=a.lToTime2,this.wxData.sToTime2=a.sToTime2),i?this.disableCanOrder():this.enableCanOrder(!0)}},fireWhenNoCwh:function(){delete this.wxData.lOrderId,delete this.wxData.iSpecial,delete this.wxData.lRule1Id,delete this.wxData.dPayable,delete this.wxData.dNowDebt,delete this.wxData.dBuyHours,delete this.wxData.dBuyMoney,delete this.wxData.lTime1,delete this.wxData.lTime2,delete this.wxData.lPayTime,delete this.wxData.lToTime1,delete this.wxData.sToTime1,delete this.wxData.lToTime2,delete this.wxData.sToTime2},disableCanOrder:function(){this.stp.enable=!1,this.stp.disableCan=!1,this.stp.parkingTime=0,this.stp.parkingTimeActiveIndex=-1,this.showOrHideMoneyTips(0,!1),this.showOrHideMoneyTips(2,!1)},enableCanOrder:function(t){t&&(this.parkingTimeChange(this.wxData.dBuyHours||0),this.stp.disableCan=!0),this.stp.enable=!0,null!=this.wxData.dPayable&&void 0!=this.wxData.dPayable&&this.wxData.dPayable>0?this.showOrHideMoneyTips(0,!0):this.showOrHideMoneyTips(0,!1),null!=this.wxData.dPayable&&void 0!=this.wxData.dPayable&&0==this.wxData.dPayable&&null!=this.wxData.dBuyHours&&void 0!=this.wxData.dBuyHours&&this.wxData.dBuyHours>0?this.showOrHideMoneyTips(1,!0):this.showOrHideMoneyTips(1,!1),null!=this.wxData.dBuyHours&&void 0!=this.wxData.dBuyHours&&this.wxData.dBuyHours>0&&null!=this.wxData.dPayable&&void 0!=this.wxData.dPayable&&0!=this.wxData.dPayable?this.showOrHideMoneyTips(2,!0):this.showOrHideMoneyTips(2,!1),this.stp.payMoney=this.getWxDFee()},showOrHideMoneyTips:function(t,e){switch(t){case 0:this.tips.moneyTips0=e?n.replace("%dPayable%",this.wxData.dPayable/100).replace("%sToTime1%",this.wxData.sToTime1).replace("%dNowDebt%",this.wxData.dNowDebt/100):"";break;case 1:this.tips.moneyTips1=e?o.replace("%dBuyHours%",this.wxData.dBuyHours).replace("%dBuyMoney%",this.wxData.dBuyMoney/100).replace("%sToTime2%",this.wxData.sToTime2):"";break;case 2:this.tips.moneyTips2=e?r.replace("%dBuyHours%",this.wxData.dBuyHours).replace("%dBuyMoney%",this.wxData.dBuyMoney/100).replace("%sToTime2%",this.wxData.sToTime2):"";break}},getWxDFee:function(){var t=this.wxData.dNowDebt;return isNaN(t)&&(t=0),null!=this.wxData.dBuyMoney&&void 0!=this.wxData.dBuyMoney&&(null==t||void 0==t?t=this.wxData.dBuyMoney:t+=this.wxData.dBuyMoney),t},gopay:function(){var e=this,a=null;this.isPlateNoFlag()?a=this.scp.plateNo:this.wxData.iSpecial==s&&(a=this.wxData.sPlateNo);var n=null;if(this.isSpaceNoFlag()&&(n=this.scwh.spaceNo),null==a||null==n)return!1;var o=!1,r=null;if(null!=this.wxData.lOrderId&&void 0!=this.wxData.lOrderId?(r=this.wxData.lOrderId,o="0"==r&&0==this.wxData.iCustCanOrder):o=0==this.wxData.iCustCanOrder,o)return!1;null==r&&(r=0);var l=this.getWxDFee();if(null==l||void 0==l||l<=0)return!1;var h={plateNo:a,spaceNo:n,orderId:r,lRule1Id:this.wxData.lRule1Id,amount:l};this.$http.request({url:"/wx/jsonPreparePay",data:h,method:"POST",dataType:"json",success:function(t){var a=t.data;if(a.success)if(a.useCounter){var s=[];for(var n in h)null!=h[n]&&void 0!=h[n]&&s.push(n+"="+encodeURIComponent(h[n]));s.push("busicom_name="+encodeURIComponent(a.busicom_name)),i.navigateTo({url:"tingcheCashier?"+s.join("&")+"&counters="+JSON.stringify(a.counters)+"&dbuyhours="+e.stp.parkingTime})}else i.requestPayment({provider:"wxpay",orderInfo:{appid:a.prepayInfo.appid,noncestr:a.prepayInfo.nonce_str,package:a.prepayInfo["package"],partnerid:a.prepayInfo.partnerid,prepayid:a.prepayInfo.prepayid,timestamp:Number(a.prepayInfo.timestamp),sign:a.prepayInfo.sign},success:function(t){e.$api.msg("支付成功"),i.navigateBack({delta:1})},fail:function(t){e.$api.msg("支付失败")}});else e.openShowTips(0,a.errorText)},fail:function(e){console.log(t(e," at pages\\tingche\\tingche.vue:719"))}})}}};e.default=w}).call(this,a("0de9")["default"],a("6e42")["default"])},ea36:function(t,e,a){"use strict";a.r(e);var i=a("d509"),s=a.n(i);for(var n in i)"default"!==n&&function(t){a.d(e,t,function(){return i[t]})}(n);e["default"]=s.a}},[["6d11","common/runtime","common/vendor"]]]);